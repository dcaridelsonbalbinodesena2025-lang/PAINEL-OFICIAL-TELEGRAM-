<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCM - BRAIN PRO MULTI-ESTRATÃ‰GIA</title>
    <style>
        :root { 
            --neon-blue: #1e90ff; --neon-green: #00ff88; --neon-red: #ff3355; 
            --gale: #f0b90b; --bg-dark: #05070a; --royal-blue: #0047AB;
        }
        body { background: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .logo { font-size: 22px; font-weight: 900; color: #fff; margin: 10px 0; }
        .logo span { color: var(--neon-blue); font-style: italic; }
        
        /* PAINEL FINANCEIRO */
        .painel-financeiro { background: #111418; border: 2px solid var(--neon-green); border-radius: 15px; width: 95%; max-width: 600px; padding: 15px; margin-bottom: 15px; }
        .fin-row { display: flex; gap: 10px; justify-content: space-between; margin-bottom: 15px; }
        .fin-input-group { flex: 1; }
        .fin-input-group label { font-size: 9px; color: #888; display: block; margin-bottom: 4px; }
        .fin-input { width: 90%; background: #000; border: 1px solid #333; color: #fff; padding: 8px; border-radius: 5px; font-weight: bold; }
        
        .display-stats { display: flex; justify-content: space-around; text-align: center; margin-top: 10px; }
        .display-stats div { flex: 1; }
        .display-stats span { font-size: 8px; color: #888; display: block; }
        .display-stats b { font-size: 14px; }

        /* PAINEL CENTRAL DE ESTRATÃ‰GIAS */
        .painel-central { background: #111418; border-radius: 15px; width: 95%; max-width: 600px; padding: 15px; border: 1px solid #222; margin-bottom: 15px; }
        .grid-estrat { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .estrat-card { background: #000; padding: 10px; border-radius: 10px; border: 1px solid #222; text-align: center; }
        .estrat-name { font-size: 9px; color: #888; margin-bottom: 5px; text-transform: uppercase; }
        .btn-toggle { background: var(--neon-green); color: #000; padding: 6px; font-size: 10px; font-weight: bold; border-radius: 5px; border: none; width: 100%; cursor: pointer; }
        .btn-off { background: var(--neon-red); color: #fff; }

        /* BARRA DE PLACAR */
        .barra-global { background: #05070a; border: 1px solid var(--royal-blue); border-radius: 10px; width: 95%; max-width: 600px; padding: 10px 0; display: flex; justify-content: space-around; margin-bottom: 20px; }
        .stat-item { text-align: center; }
        .stat-item span { font-size: 8px; color: #888; }
        .stat-item b { display: block; font-size: 14px; }

        /* MONITORES */
        .grid-monitores { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 600px; }
        .card { background: #080a0d; border-radius: 15px; padding: 12px; border: 1px solid #1e2228; text-align: center; }
        .status-box { background: #000; padding: 6px; border-radius: 5px; margin-bottom: 8px; font-size: 9px; color: var(--neon-blue); font-weight: bold; border: 1px solid #222; min-height: 25px; display: flex; align-items: center; justify-content: center; }
        .price { color: var(--gale); font-family: monospace; font-size: 11px; margin-bottom: 8px; display: block; }
        .select-ativo { background: #000; color: #fff; border: 1px solid #444; font-size: 10px; width: 100%; padding: 5px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="logo">K.C<span>ðŸ“ˆ</span>M MULTI-ESTRATÃ‰GIA PRO</div>

    <div class="painel-financeiro">
        <div class="fin-row">
            <div class="fin-input-group">
                <label>BANCA ATUAL (R$)</label>
                <input type="number" id="inpBanca" class="fin-input" value="5000">
            </div>
            <div class="fin-input-group">
                <label>SIMULADOR (%)</label>
                <input type="number" id="inpSim" class="fin-input" value="1">
            </div>
        </div>
        <div class="display-stats">
            <div><span>VALOR ENTRADA</span><b id="display-entrada" style="color:var(--neon-green)">R$ 50.00</b></div>
            <div><span>LUCRO SESSÃƒO</span><b id="display-lucro" style="color:var(--neon-blue)">R$ 0.00</b></div>
        </div>
    </div>

    <div class="painel-central">
        <div class="grid-estrat">
            <div class="estrat-card">
                <div class="estrat-name">BRAIN PRO (M5)</div>
                <button id="btn-brain" class="btn-toggle" onclick="toggleEstrat('brain')">ATIVO</button>
            </div>
            <div class="estrat-card">
                <div class="estrat-name">ENGOLFO + EMA20</div>
                <button id="btn-engolfo" class="btn-toggle" onclick="toggleEstrat('engolfo')">ATIVO</button>
            </div>
        </div>
    </div>

    <div class="barra-global">
        <div class="stat-item"><span>G: (WINS)</span><b id="v-g" style="color:var(--neon-green)">0</b></div>
        <div class="stat-item"><span>R: (LOSS)</span><b id="v-r" style="color:var(--neon-red)">0</b></div>
        <div class="stat-item"><span>PRECISÃƒO</span><b id="v-prec">0%</b></div>
    </div>

    <div class="grid-monitores" id="grid"></div>

<script>
    const TOK = "8427077212:AAEiL_3_D_-fukuaR95V3FqoYYyHvdCHmEI";
    const CID = "-1003355965894";
    
    let banca = 5000, g = 0, r = 0, lucro = 0;
    let motores = {};
    let estatsAtivas = { brain: true, engolfo: true };

    const LISTA_COMPLETA = [
        { id: "NONE", nome: "âŒ DESATIVAR SLOT" },
        { id: "R_10", nome: "ðŸ“Š Volatility 10" },
        { id: "R_50", nome: "ðŸ“Š Volatility 50" },
        { id: "R_75", nome: "ðŸ“Š Volatility 75" },
        { id: "1HZ10V", nome: "ðŸ“ˆ Volatility 10 (1s)" },
        { id: "1HZ75V", nome: "ðŸ“ˆ Volatility 75 (1s)" },
        { id: "frxEURUSD", nome: "ðŸ’± EUR/USD" },
        { id: "cryBTCUSD", nome: "â‚¿ BITCOIN" }
    ];

    function sendTG(m, btn = false) {
        let u = `https://api.telegram.org/bot${TOK}/sendMessage?chat_id=${CID}&text=${encodeURIComponent(m)}&parse_mode=Markdown`;
        if(btn) {
            let kb = { inline_keyboard: [[{ text: "ðŸ‘‰ Clique agora!", url: "https://track.deriv.com/_S_W1N_" }]] };
            u += `&reply_markup=${encodeURIComponent(JSON.stringify(kb))}`;
        }
        fetch(u).catch(() => {});
    }

    function calcEMA(data, p) {
        let k = 2/(p+1), ema = data[0].close;
        for(let i=1; i<data.length; i++) ema = (data[i].close * k) + (ema * (1-k));
        return ema;
    }

    function toggleEstrat(id) {
        estatsAtivas[id] = !estatsAtivas[id];
        const btn = document.getElementById(`btn-${id}`);
        btn.innerText = estatsAtivas[id] ? "ATIVO" : "DESATIVADO";
        btn.classList.toggle('btn-off', !estatsAtivas[id]);
    }

    function initMotor(id, asset, name) {
        if(motores[id]?.ws) motores[id].ws.close();
        if(asset === "NONE") return;

        let m = { name, ws: new WebSocket('wss://ws.binaryws.com/websockets/v3?app_id=1089'), v1: [], v5: [], ema: 0 };
        m.ws.onopen = () => {
            m.ws.send(JSON.stringify({ ticks: asset }));
            m.ws.send(JSON.stringify({ ticks_history: asset, end: "latest", count: 40, granularity: 60, subscribe: 1 }));
            m.ws.send(JSON.stringify({ ticks_history: asset, end: "latest", count: 5, granularity: 300, subscribe: 1 }));
        };

        m.ws.onmessage = (e) => {
            let res = JSON.parse(e.data);
            if(res.tick) document.getElementById(`pr-${id}`).innerText = res.tick.quote;
            if(res.candles) {
                if(res.echo_req.granularity === 60) m.v1 = res.candles;
                if(res.echo_req.granularity === 300) m.v5 = res.candles;
            }
            if(res.ohlc && res.ohlc.granularity === 60) {
                m.v1[m.v1.length-1] = { open: res.ohlc.open, close: res.ohlc.close, high: res.ohlc.high, low: res.ohlc.low };
                if(m.v1.length >= 20) m.ema = calcEMA(m.v1, 20);
                if(parseInt(res.ohlc.epoch) % 60 === 45) checkLogic(id, true);
                if(parseInt(res.ohlc.epoch) % 60 === 0) checkLogic(id, false);
            }
            document.getElementById(`st-${id}`).innerText = m.ema > 0 ? "ATIVO" : "SINCRO...";
        };
        motores[id] = m;
    }

    function checkLogic(id, isPre) {
        if(!estatsAtivas.brain && !estatsAtivas.engolfo) return;
        let m = motores[id];
        if(!m || m.v1.length < 2 || m.v5.length < 1 || m.ema === 0) return;
        
        let c = m.v1[m.v1.length-1], a = m.v1[m.v1.length-2], t5 = m.v5[m.v5.length-1];
        let pad = "", dir = "";

        if(c.close > a.open && c.close > a.close) { pad = "ENGOLFO ALTA"; dir = "CALL"; }
        else if(c.close < a.open && c.close < a.close) { pad = "ENGOLFO BAIXA"; dir = "PUT"; }

        if(pad !== "") {
            let okM5 = (dir === "CALL" ? t5.close > t5.open : t5.close < t5.open);
            let okEMA = (dir === "CALL" ? m.ema < c.low : m.ema > c.high);

            if(okM5 && okEMA) {
                let ent = (parseFloat(document.getElementById('inpBanca').value) * (document.getElementById('inpSim').value/100)).toFixed(2);
                if(isPre) {
                    sendTG(`âš ï¸ *ALERTA BRAIN PRO*\n\nðŸ“Š Ativo: ${m.name}\nðŸŽ¯ PadrÃ£o: ${pad}\nðŸ“ˆ Filtro: PADRÃƒO PURO âœ…\nðŸ•“ PossÃ­vel entrada: ${new Date().toLocaleTimeString()}`);
                } else {
                    sendTG(`ðŸš€ *ENTRADA CONFIRMADA*\n\nðŸ‘‰Clique agora!\nðŸ“Š Ativo: ${m.name}\nðŸŽ¯ PadrÃ£o: ${pad}\nðŸ“ˆ DireÃ§Ã£o: ${dir}\nðŸ’° Entrada: R$ ${ent}\nðŸ’°Banca atual: R$ ${document.getElementById('inpBanca').value}\nâ° Inicio: ${new Date().toLocaleTimeString()}\nðŸ Fim: ${new Date(Date.now()+60000).toLocaleTimeString()}`, true);
                }
            }
        }
    }

    function syncUI() {
        banca = parseFloat(document.getElementById('inpBanca').value);
        let sim = parseFloat(document.getElementById('inpSim').value);
        document.getElementById('display-entrada').innerText = "R$ " + (banca * (sim/100)).toFixed(2);
        document.getElementById('v-g').innerText = g;
        document.getElementById('v-r').innerText = r;
        document.getElementById('display-lucro').innerText = "R$ " + lucro.toFixed(2);
    }

    const grid = document.getElementById('grid');
    let opts = LISTA_COMPLETA.map(a => `<option value="${a.id}">${a.nome}</option>`).join('');
    for (let i = 1; i <= 6; i++) {
        grid.innerHTML += `<div class="card"><div style="font-size:8px; color:#888;">MONITOR ${i}</div><div class="status-box" id="st-${i}">OFF</div><b class="price" id="pr-${i}">0.0000</b><select class="select-ativo" onchange="initMotor(${i}, this.value, this.options[this.selectedIndex].text)">${opts}</select></div>`;
    }
    setInterval(syncUI, 1000);
</script>
</body>
</html>
